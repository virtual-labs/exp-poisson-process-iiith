<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Merging and Splitting of Poisson Process</title>

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/virtual-labs/virtual-style@0.0.8-b/css/style.min.css"
  />
  <link rel="stylesheet" href="./css/css1.css" /> 

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <style>
    body {
      padding-top: 20px;
    }

    .tasks-heading {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #444;
    }

    .v-tabs ul {
      display: flex;
      overflow-x: auto;
      white-space: nowrap;
      list-style: none;
      padding: 0;
      margin: 0 3%;
      border-bottom: 1px solid #ddd;
    }
    .v-tabs li {
      display: inline-block;
      margin: 0;
    }
    .v-tabs a {
      display: inline-block;
      padding: 0.75rem 1.25rem;
      text-decoration: none;
      color: #333;
      font-weight: 500;
    }
    .v-tabs li.active > a {
      color: #3273dc;
      border-bottom: 3px solid #3273dc;
    }
    .v-tabs a:hover {
      background-color: #f0f0f0;
      border-radius: 4px;
    }
    .subheading-box {
      background-color: #f7fdf7;
      border-left: 4px solid #3c763d;
      padding: 0.75rem 1rem;
      margin: 1rem 3% 1.5rem 3%;
      border-radius: 4px;
    }
    .subheading-box .title {
      color: #3c763d;
      font-size: 1.25rem;
      margin: 0;
      font-weight: 600;
    }

    .controls-container {
      display: flex;
      justify-content: space-around; /* Distributes space between items */
      align-items: center;    /* Vertically center items */
      flex-wrap: wrap;
      gap: 1.5rem; /* Increased gap for tidiness */
      padding: 0.5rem 0; /* Padding for the container itself */
    }
    .field {
      flex: 1; /* Allows fields to grow */
      min-width: 250px; /* Minimum width before wrapping */
      max-width: 300px; /* Maximum width to prevent excessive stretching */
    }
    .label {
      display: block;
      text-align: center;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }
    .value-display {
      display: block;
      text-align: center;
      font-weight: bold;
      margin-top: 0.3rem;
    }
    .slider { /* Copied from your original CSS for exp2 */
        -webkit-appearance: none;
        width: 100%;
        height: 10px;
        border-radius: 5px;
        background: #ddd;
        outline: none;
    }
    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3273dc;
        cursor: pointer;
    }
    .slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3273dc;
        cursor: pointer;
    }

    .nucleus-img {
      position: absolute;
      width: 80px;
      height: 80px;
      transform: translate(-50%, -50%); /* Center the image on its left/top point */
    }

    #animationContainer {
      position: relative;
      height: 400px; /* Increased height */
      width: 100%;
      background-color: #f8f8f8; /* Light background for visibility */
      border-radius: 4px;
    }
    #emitCanvas { 
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background-color: transparent !important;
      border: none !important;
    }
    #lineChart,
    #histogramChart {
      width: 100% !important;
      height: 100% !important;
    }
    .chart-wrapper { 
        position: relative;
        height: 250px; /* Increased height */
        margin-bottom: 1rem;
    }
    .chart-wrapper:last-child {
        margin-bottom: 0;
    }


    .buttons.has-addons .button.is-primary {
      background-color: #3273dc;
      color: #ffffff;
      border-color: #3273dc;
    }
    .buttons.has-addons .button {
      border: 1px solid #ddd;
    }
    .buttons.has-addons .button:hover:not(.is-primary) { 
      background-color: #f0f0f0;
      color: #333;
    }

    .main-experiment-panel {
        border: 2px solid #8dc63f !important; /* Matching exp1.html's visual */
        border-radius: 8px !important;
        padding-bottom: 10px !important; /* Ensure space at bottom */
    }
    .white-boxed-panel {
        background-color: #fff;
        border: 1px solid #dbdbdb; /* Standard Bulma card/box border */
        border-radius: 6px;
        padding: 1.25rem; /* Consistent padding */
        margin-bottom: 1.5rem; /* Space below panel */
    }
    .white-boxed-panel:last-child {
        margin-bottom: 0;
    }
    .white-boxed-panel .v-datalist-title { /* For Observations panel title */
        margin-bottom: 0.75rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #eee;
    }

  </style>
</head>

<body>
  <div class="container"> 

    <div class="tasks-heading">Tasks</div>

    <div class="v-tabs">
      <ul>
        <li onclick="window.location.href='exp1.html';"><a>Sub Experiment – 1</a></li>
        <li class="active"><a>Sub Experiment–2</a></li>
        <li onclick="window.location.href='exp3.html';"><a>Sub Experiment – 3</a></li>
      </ul>
    </div>

    <div class="subheading-box">
      <p class="title">Merging and Splitting of Poisson Process</p>
    </div>

    <div class="columns is-centered">
      <div class="column is-11-desktop is-12-tablet is-12-mobile">
        <div class="v-collapsible-instruction-container v-instruction-container">
          <div class="v-collapsible is-size-5 v-collapsed">Instructions</div> <!-- v-collapsed to start closed -->
          <div class="v-content" style="text-align: left; padding: 1rem 10% 0.5rem 10%;">
            <ul style="list-style: disc;">
              <li>Two independent Poisson “emitters” (radioactive nuclei) have rates \(\lambda_1\) and \(\lambda_2\).</li>
              <li>
                <strong>Merging:</strong> The two Poisson streams (\(\lambda_1, \lambda_2\)) combine into a single Poisson
                stream of rate \(\lambda_1 + \lambda_2\). Each second, we sample Poisson(\(\lambda_1 + \lambda_2\)) for the emission count.
              </li>
              <li>
                <strong>Splitting:</strong> Independently generate Poisson(\(\lambda_1\)) and Poisson(\(\lambda_2\)) each second
                to recreate the two separate streams (with random variation).
              </li>
              <li>Use the sliders below to set \(\lambda_1\) and \(\lambda_2\), and click the “Merging” or “Splitting” button.</li>
              <li>
                On the left, the nuclei will merge into one or split into two when you switch modes.
                Each emission scatters a small particle icon in a random direction from its nucleus.
              </li>
              <li>
                On the right, you’ll see two chart panels:
                <ol style="margin-top: 8px; margin-bottom: 4px;">
                  <li>A real-time line chart of “counts per second” (sliding 30 s window).</li>
                  <li>A histogram of the empirical distribution of counts (last 100 points by default).</li>
                </ol>
              </li>
              <li>
                The “Observations” panel below shows the running average emission rate vs. theoretical \(\lambda\),
                and the absolute error |empirical – theoretical| in real time.
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <br />

    <div class="columns is-centered">
      <div class="column is-11-desktop is-12-tablet is-12-mobile">
        <div class="v-datalist-container components-list main-experiment-panel">
          <h3 class="v-datalist-title" style="text-align: center; margin-top: 10px; margin-bottom: 20px;">
            Poisson Merge/Split Simulation
          </h3>

          <div class="white-boxed-panel" style="margin: 0 1% .5rem 1%;">
            <div class="controls-container">
              <!-- λ₁ Slider -->
              <div class="field">
                <label for="lambda1" class="label">\(\lambda_1\) (Emitter 1):</label>
                <input type="range" id="lambda1" min="1" max="30" step="1" value="6" class="slider" />
                <span id="lambda1Val" class="value-display">6</span>
              </div>
              <!-- λ₂ Slider -->
              <div class="field">
                <label for="lambda2" class="label">\(\lambda_2\) (Emitter 2):</label>
                <input type="range" id="lambda2" min="1" max="30" step="1" value="4" class="slider" />
                <span id="lambda2Val" class="value-display">4</span>
              </div>
              <!-- Mode Buttons -->
              <div class="field">
                <label class="label">Mode:</label>
                <div class="buttons has-addons is-centered"> <!-- is-centered for buttons div -->
                  <button id="mergeBtn" class="button is-primary">Merging</button>
                  <button id="splitBtn" class="button">Splitting</button>
                </div>
              </div>
            </div>
          </div>

          <div class="columns is-multiline is-variable is-2" style="margin: 0 0.5% 3rem 0.5%;">
            <div class="column is-half">
              <div class="white-boxed-panel" style="padding: 1rem;">
                 <h4 class="v-datalist-subtitle" style="text-align:center; margin-bottom: 0.75rem; font-weight: 600;">Live Emission Animation</h4>
                <div id="animationContainer">
                  <!-- Emitter 1 nucleus -->
                  <img src="./images/atom1.png" alt="Emitter 1" class="nucleus-img" id="nuc1" style="display:none; opacity:0;"/>
                  <!-- Emitter 2 nucleus -->
                  <img src="./images/atom1.png" alt="Emitter 2" class="nucleus-img" id="nuc2" style="display:none; opacity:0;"/>
                  <!-- Merged nucleus -->
                  <img src="./images/atom2.png" alt="Merged" class="nucleus-img" id="nucMerged" style="display:none; opacity:0;"/>
                  <!-- Transparent canvas for particle emissions (if needed, current JS uses DOM particles) -->
                  <canvas id="emitCanvas"></canvas>
                </div>
              </div>
            </div>

            <!-- Right: Charts Panel (White-boxed, two canvases) -->
            <div class="column is-half">
              <div class="white-boxed-panel" style="padding: 1rem;">
                <h4 class="v-datalist-subtitle" style="text-align:center; margin-bottom: 0.75rem; font-weight: 600;">Real-time Data Plots</h4>
                <!-- Real‐time Line Chart -->
                <div class="chart-wrapper">
                  <canvas id="lineChart"></canvas>
                </div>
                <!-- Empirical Histogram -->
                <div class="chart-wrapper">
                  <canvas id="histogramChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- ========== Observations Panel (White-boxed, styled like Exp 1) ========== -->
          <div class="white-boxed-panel" style="margin: 0 3% 1.5rem 3%;">
            <div class="v-datalist-title">Observations</div>
            <div id="observations" style="padding-top: 0.5rem;">
                <!-- JS will inject content here -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- End .container -->

  <!-- Virtual-Labs JS (for collapsible behavior) - MOVED TO END OF BODY -->
  <script src="https://cdn.jsdelivr.net/gh/virtual-labs/virtual-style@0.0.8-b/js/script.js"></script>
  <!-- ========== Simulation Script ========== -->
  <script src="./js/merge_split.js"></script>
</body>
</html>